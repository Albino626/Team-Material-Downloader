# 多团队服务器配置说明

## 📋 功能概述

为了解决在uTools中多个团队使用同一个前端但需要连接不同服务器的问题，我们实现了**多团队服务器配置管理功能**。

### 核心特性

✅ **本地独立配置** - 每个用户的配置保存在本地浏览器（localStorage），互不干扰  
✅ **多服务器管理** - 支持保存多个服务器配置，快速切换  
✅ **实时状态显示** - 状态栏显示当前连接的服务器地址  
✅ **一键切换** - 通过按钮快速切换不同团队的服务器  
✅ **连接测试** - 测试服务器连接状态，确保配置正确  

---

## 🎯 工作原理

### 数据存储

- **存储位置**: 浏览器 `localStorage`
- **存储内容**:
  - `serverUrl`: 当前使用的服务器地址
  - `serverConfigs`: 保存的多个服务器配置列表

### 独立性保证

每个用户在uTools中使用插件时：
- ✅ 拥有独立的 `localStorage` 存储空间
- ✅ 配置互不干扰
- ✅ 可以配置不同的服务器地址
- ✅ 可以保存多个团队服务器配置

---

## 🚀 使用方法

### 方法一：快速配置（推荐）

1. **打开插件** → 点击状态栏右侧的 **🌐 按钮**
2. **输入管理员密码** 解锁管理员功能
3. **进入"系统设置"** → 找到"团队服务器配置"
4. **添加服务器**:
   - 点击"➕ 添加服务器"
   - 输入服务器名称（例如：团队A服务器）
   - 输入服务器地址（例如：http://192.168.1.100:3000）
5. **切换服务器**:
   - 在配置列表中点击"切换"按钮
   - 或使用"🔄 快速切换"功能

### 方法二：直接输入

1. **进入管理员面板** → "系统设置"
2. **在"当前服务器地址"输入框**中输入服务器地址
3. **点击"💾 保存当前配置"**
4. 系统会提示是否保存到配置列表

### 方法三：测试连接

1. 在"当前服务器地址"输入框中输入服务器地址
2. 点击"🔍 测试连接"按钮
3. 查看连接结果

---

## 📱 界面说明

### 状态栏显示

```
[●] 已连接  http://192.168.1.100:3000  [🌐] [🔄]
```

- **●**: 连接状态指示器（绿色=已连接，灰色=未连接）
- **已连接**: 连接状态文本
- **http://...**: 当前服务器地址（自动显示）
- **🌐**: 快速打开服务器配置
- **🔄**: 刷新连接状态

### 服务器配置列表

在"系统设置"中可以看到：

```
┌─────────────────────────────────────┐
│ 团队A服务器 (当前)                  │
│ http://192.168.1.100:3000          │
│                          [切换][删除]│
├─────────────────────────────────────┤
│ 团队B服务器                         │
│ http://192.168.1.200:3000          │
│                          [切换][删除]│
└─────────────────────────────────────┘
```

---

## 💡 使用场景

### 场景1：单一团队使用

- 配置一个服务器地址
- 所有团队成员使用相同的服务器
- 配置保存在每个用户的浏览器中

### 场景2：多团队使用

- **团队A**: 配置 `http://192.168.1.100:3000`
- **团队B**: 配置 `http://192.168.1.200:3000`
- **团队C**: 配置 `http://192.168.1.300:3000`

每个团队成员：
1. 添加自己团队的服务器配置
2. 切换到对应的服务器
3. 开始使用

### 场景3：临时切换

- 保存了多个服务器配置
- 需要临时切换到另一个服务器
- 使用"快速切换"功能
- 使用完毕后切换回来

---

## 🔧 技术实现

### 数据存储结构

```javascript
// localStorage 存储
{
  "serverUrl": "http://192.168.1.100:3000",  // 当前服务器
  "serverConfigs": [                          // 配置列表
    {
      "name": "团队A服务器",
      "url": "http://192.168.1.100:3000",
      "createdAt": "2025-01-27T10:00:00.000Z"
    },
    {
      "name": "团队B服务器",
      "url": "http://192.168.1.200:3000",
      "createdAt": "2025-01-27T11:00:00.000Z"
    }
  ]
}
```

### 关键函数

- `getServerConfigs()` - 获取配置列表
- `addServerConfig(name, url)` - 添加服务器配置
- `removeServerConfig(url)` - 删除服务器配置
- `switchToServer(url)` - 切换到指定服务器
- `updateServerUrlDisplay()` - 更新状态栏显示

---

## ⚠️ 注意事项

### 1. 数据独立性

- ✅ 每个用户的配置是独立的
- ✅ 不会影响其他用户
- ✅ 清除浏览器数据会丢失配置

### 2. 服务器地址格式

- ✅ 必须包含协议：`http://` 或 `https://`
- ✅ 必须包含端口号（默认3000）
- ✅ 示例：`http://192.168.1.100:3000`

### 3. 网络连接

- 确保服务器已启动
- 确保网络可以访问服务器
- 使用"测试连接"功能验证

### 4. 配置备份

如果需要备份配置，可以：
1. 打开浏览器开发者工具（F12）
2. 进入"Application" → "Local Storage"
3. 找到对应的存储项
4. 复制 `serverConfigs` 的值

---

## 🎯 最佳实践

### 团队部署建议

1. **统一配置**:
   - 团队管理员统一提供服务器地址
   - 团队成员使用相同的配置名称

2. **命名规范**:
   - 使用清晰的名称：`团队A-主服务器`
   - 包含环境信息：`开发环境`、`生产环境`

3. **定期检查**:
   - 定期测试服务器连接
   - 及时更新失效的配置

### 故障排查

**问题**: 无法连接到服务器

**解决步骤**:
1. 检查服务器是否启动
2. 使用"测试连接"功能
3. 检查网络连接
4. 验证服务器地址格式
5. 检查防火墙设置

**问题**: 配置丢失

**原因**: 清除了浏览器数据

**解决**: 重新添加服务器配置

---

## 📊 功能对比

| 功能 | 之前 | 现在 |
|------|------|------|
| 服务器配置 | 单一配置 | ✅ 多配置管理 |
| 快速切换 | ❌ 不支持 | ✅ 一键切换 |
| 状态显示 | ❌ 不显示 | ✅ 实时显示 |
| 配置保存 | 仅当前 | ✅ 列表保存 |
| 连接测试 | ❌ 不支持 | ✅ 支持测试 |

---

## 🔄 更新日志

### v1.1.0 (2025-01-27)

- ✨ 新增多服务器配置管理
- ✨ 新增快速切换功能
- ✨ 新增状态栏服务器地址显示
- ✨ 新增连接测试功能
- 🐛 修复URL格式验证问题

---

## ❓ 常见问题

### Q1: 多个团队可以同时使用吗？

**A**: 可以！每个用户的配置是独立的，互不干扰。

### Q2: 配置会同步到其他设备吗？

**A**: 不会。配置保存在本地浏览器，不会同步。

### Q3: 如何分享服务器配置给团队成员？

**A**: 提供服务器地址，团队成员自行添加配置。

### Q4: 可以导入/导出配置吗？

**A**: 当前版本不支持，但可以通过浏览器开发者工具手动操作。

### Q5: 配置有数量限制吗？

**A**: 没有硬性限制，但建议不超过10个配置。

---

**最后更新**: 2025-01-27  
**版本**: v1.1.0

